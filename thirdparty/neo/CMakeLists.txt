find_package(Catch2 REQUIRED)
include_directories(src)
include_directories(${PROJECT_SOURCE_DIR}/thirdparty/Catch2/src)

list(APPEND CMAKE_MODULE_PATH ${PROJECT_SOURCE_DIR}/thirdparty/Catch2/extras)
include(CTest)
include(Catch)

add_library(neo STATIC
        src/neo/concepts.hpp
        src/neo/byte_pointer.hpp
        src/neo/as_dynamic_buffer.hpp
        src/neo/ref_member.hpp
        src/neo/pathological_buffer_range.hpp
        src/neo/buffer_iterator.hpp
        src/neo/invoke.hpp
        src/neo/event.hpp
        src/neo/map_ref.hpp
        src/neo/iterator_facade.hpp
        src/neo/declval.hpp
        src/neo/ad_hoc_range.hpp
        src/neo/repr.hpp
        src/neo/shared.hpp
        src/neo/utility.hpp
        src/neo/buffers_consumer.hpp
        src/neo/utf8.hpp
        src/neo/zstring_view.hpp
        src/neo/fwd.hpp
        src/neo/config-pp.hpp
        src/neo/ufmt.hpp
        src/neo/as_buffer.hpp
        src/neo/returns.hpp
        src/neo/ranges.hpp
        src/neo/out.hpp
        src/neo/mutable_buffer.hpp
        src/neo/scope.hpp
        src/neo/counting_buffers.hpp
        src/neo/bit_cast.hpp
        src/neo/switch_coro.hpp
        src/neo/tag.hpp
        src/neo/unref.hpp
        src/neo/buffer_range_adaptor.hpp
        src/neo/any_range_fwd.hpp
        src/neo/enum.hpp
        src/neo/buffer_algorithm/encode.hpp
        src/neo/buffer_algorithm/size.hpp
        src/neo/buffer_algorithm/transform.hpp
        src/neo/buffer_algorithm/decode.hpp
        src/neo/buffer_algorithm/count.hpp
        src/neo/buffer_algorithm/concat.hpp
        src/neo/buffer_algorithm/copy.hpp
        src/neo/buffer_sink.hpp
        src/neo/assert.cpp
        src/neo/arrow_proxy.hpp
        src/neo/fixed_string.hpp
        src/neo/platform.hpp
        src/neo/trivial_range.hpp
        src/neo/opt_ref_fwd.hpp
        src/neo/archetypes.hpp
        src/neo/error.hpp
        src/neo/pp.hpp
        src/neo/static_buffer_vector.hpp
        src/neo/version.hpp
        src/neo/mutref.hpp
        src/neo/detail/buffer_base.hpp
        src/neo/detail/single_buffer_iter.hpp
        src/neo/bytewise_iterator.hpp
        src/neo/optional.hpp
        src/neo/any_iterator_fwd.hpp
        src/neo/text_range.hpp
        src/neo/addressof.hpp
        src/neo/assert.hpp
        src/neo/range_archetypes.hpp
        src/neo/fixed_dynamic_buffer.hpp
        src/neo/string.hpp
        src/neo/buffer_bits.hpp
        src/neo/opt_ref.hpp
        src/neo/const_buffer.hpp
        src/neo/bytes.hpp
        src/neo/shifting_dynamic_buffer.hpp
        src/neo/any_range.hpp
        src/neo/buffer_algorithm.hpp
        src/neo/iostream_io.hpp
        src/neo/tl.hpp
        src/neo/buffers_cat.hpp
        src/neo/any_iterator.hpp
        src/neo/memory.hpp
        src/neo/byte_array.hpp
        src/neo/iterator_concepts.hpp
        src/neo/dynbuf_io.hpp
        src/neo/string_io.hpp
        src/neo/function_traits.hpp
        src/neo/dynamic_buffer.hpp
        src/neo/repr.cpp
        src/neo/buffer_source.hpp
        src/neo/range_concepts.hpp
        src/neo/attrib.hpp
        src/neo/shared_fwd.hpp
        src/neo/iterator.hpp
        src/neo/test_concept.hpp
        src/neo/overload.hpp
        src/neo/ufmt.cpp
        src/neo/transform_io.hpp
        src/neo/ref.hpp
        src/neo/buffer_range.hpp
        )

add_library(neo::neo ALIAS neo)


add_executable(neo_tests
        test/neo/config-pp.test.cpp
        test/neo/as_buffer.test.cpp
        test/neo/iterator_concepts.test.cpp
        test/neo/fixed_string.test.cpp
        test/neo/byte_pointer.test.cpp
        test/neo/event.test.cpp
        test/neo/range_archetypes.test.cpp
        test/neo/buffers_consumer.test.cpp
        test/neo/buffer_source.test.cpp
        test/neo/zstring_view.test.cpp
        test/neo/buffer_bits.test.cpp
        test/neo/fixed_dynamic_buffer.test.cpp
        test/neo/archetypes.test.cpp
        test/neo/error.test.cpp
        test/neo/buffer_range_adaptor.test.cpp
        test/neo/dynamic_buffer.test.cpp
        test/neo/buffer_sink.test.cpp
        test/neo/ref.test.cpp
        test/neo/ad_hoc_range.test.cpp
        test/neo/bytes.test.cpp
        test/neo/any_iterator.test.cpp
        test/neo/tag.test.cpp
        test/neo/static_buffer_vector.test.cpp
        test/neo/const_buffer.test.cpp
        test/neo/enum.test.cpp
        test/neo/ref_member.test.cpp
        test/neo/iterator_facade.test.cpp
        test/neo/concepts.test.cpp
        test/neo/trivial_range.test.cpp
        test/neo/assert.test.cpp
        test/neo/buffer_algorithm/size.test.cpp
        test/neo/buffer_algorithm/decode.test.cpp
        test/neo/buffer_algorithm/transform.test.cpp
        test/neo/buffer_algorithm/copy.test.cpp
        test/neo/buffer_algorithm/concat.test.cpp
        test/neo/buffer_algorithm/encode.test.cpp
        test/neo/switch_coro.test.cpp
        test/neo/shifting_dynamic_buffer.test.cpp
        test/neo/overload.test.cpp
        test/neo/mutref.test.cpp
        test/neo/bytewise_iterator.test.cpp
        test/neo/scope.test.cpp
        test/neo/transform_io.test.cpp
        test/neo/text_range.test.cpp
        test/neo/ufmt.test.cpp
        test/neo/out.test.cpp
        test/neo/buffers_cat.test.cpp
        test/neo/string.test.cpp
        test/neo/iostream_io.test.cpp
        test/neo/platform.test.cpp
        test/neo/pathological_buffer_range.test.cpp
        test/neo/unref.test.cpp
        test/neo/ranges.test.cpp
        test/neo/string_io.test.cpp
        test/neo/utf8.test.cpp
        test/neo/dynbuf_io.test.cpp
        test/neo/mutable_buffer.test.cpp
        test/neo/byte_array.test.cpp
        test/neo/shared.test.cpp
        test/neo/utility.test.cpp
        test/neo/as_dynamic_buffer.test.cpp
        test/neo/returns.test.cpp
        test/neo/opt_ref.test.cpp
        test/neo/function_traits.test.cpp
        test/neo/any_range.test.cpp
        test/neo/pp.test.cpp
        test/neo/range_concepts.test.cpp
        test/neo/buffer_iterator.test.cpp
        test/neo/invoke.test.cpp
        test/neo/tl.test.cpp
        test/neo/bit_cast.test.cpp
        test/neo/optional.test.cpp
        test/neo/counting_buffers.test.cpp
        test/neo/repr.test.cpp
        )

target_link_libraries(neo_tests
        neo
        Catch2::Catch2WithMain
        )

catch_discover_tests(neo_tests)
